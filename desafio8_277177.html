<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joaquim Bertoldi Nucci">

<title>Desafio 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="desafio8_277177_files/libs/clipboard/clipboard.min.js"></script>
<script src="desafio8_277177_files/libs/quarto-html/quarto.js"></script>
<script src="desafio8_277177_files/libs/quarto-html/popper.min.js"></script>
<script src="desafio8_277177_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="desafio8_277177_files/libs/quarto-html/anchor.min.js"></script>
<link href="desafio8_277177_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="desafio8_277177_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="desafio8_277177_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="desafio8_277177_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="desafio8_277177_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Desafio 8</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joaquim Bertoldi Nucci </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Relatório gerado em:"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%d/%m/%Y %H:%M:%S"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Relatório gerado em: 24/09/2025 22:10:49</code></pre>
</div>
</div>
<ol type="1">
<li>Baixe o arquivo uwmadison.sqlite3. Conecte-se a ele usando o pacote RSQLite, armazenando a conexão em uma variável conn.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pacote 'RSQLite' foi compilado no R versão 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">=</span> <span class="fu">dbConnect</span>(<span class="fu">SQLite</span>(), <span class="st">"dados/uwmadison.sqlite3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Quem são e quantos são os professores que lecionaram disciplinas cujo tópico era estatística (subjects.abbreviation=‘STAT’)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"SELECT DISTINCT(instructors.name) FROM instructors INNER JOIN teachings</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">           ON instructors.id = teachings.instructor_id INNER JOIN sections</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">           ON teachings.section_uuid = sections.uuid INNER JOIN subject_memberships</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">           ON subject_memberships.course_offering_uuid = sections.course_offering_uuid</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">           INNER JOIN subjects</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">           ON subject_memberships.subject_code = subjects.code</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">           WHERE subjects.abbreviation = 'STAT'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             name
1                     MINJING TAO
2                   DONALD PORTER
3                      SHENG WANG
4                   KUNLING HUANG
5                        DONG XIA
6                 JENNIFER NGUYEN
7                     SEULKEE YUN
8                      DUZHE WANG
9                     YONGFENG WU
10                    JARED BROWN
11                    YUCHEN ZHOU
12                     VICTOR LUO
13                 GUN WOONG PARK
14                    BROOK LUERS
15                     DUY NGUYEN
16                   JOHN GILLETT
17                      QUOC TRAN
18                      YAOYAO XU
19                      JIE ZHANG
20                      LONG PHAN
21                   WESLEY CHANG
22                        TONG LI
23                   SHANE HUBLER
24                       FAN YANG
25                     JU HEE CHO
26                      JEEA CHOI
27                     SHIXUE LIU
28                    WEI-YIN LOH
29                        BIN DAI
30                     XIPEI YANG
31               DOUGLAS M. BATES
32           MICHAEL GEORGE ILTIS
33                  LIAM JOHNSTON
34                   CRYSTAL CHEN
35                      YIFAN MEI
36                       RUI CHEN
37                      JILI WANG
38                    LUWAN ZHANG
39                 GINA BENNINGER
40                       JIE SONG
41                       XIWEN MA
42                       HAODA FU
43                   DEYUAN JIANG
44                 JINGJIANG PENG
45              ERICA LEE DEADMAN
46                 AKICHIKA OZEKI
47                      MENG SONG
48                       HAO TENG
49                    DONGGYU KIM
50                COLIN LONGHURST
51                FREDERICK BOEHM
52                     YONGSU LEE
53               GONZALO CONTADOR
54                       HAO CHEN
55                      XIN ZHANG
56                        BO YANG
57                    RUNGANG HAN
58                      SEAN KENT
59                     DEBRAJ DAS
60                          YI LI
61                   CLAIRE BOBST
62                      CHAN PARK
63                      SIJING LI
64                    SHENGJI JIA
65                     YUCHANG WU
66                      ZHUANG WU
67                     XIAOMAO LI
68                    HYEBIN SONG
69                      YOURAN QI
70                 YOUNG MIN PARK
71                      BIN ZHANG
72                    QIURONG CUI
73                      SEHO PARK
74                    SHENG ZHANG
75                   HUIKUN ZHANG
76                 ALYSSA DIGILIO
77                      YUQING XU
78                   STEPHEN BERG
79                    PEIGEN ZHOU
80                       YAN CHEN
81                    QIONG ZHANG
82                YOUNGDEOK HWANG
83                       HAN CHEN
84        NICHOLAS STEPHEN KEULER
85                   ZHENGXIAO WU
86                    YUJIN CHUNG
87                   WENWEN ZHANG
88                    PERLA REYES
89                        QI TANG
90                 CHIA-CHIEH LIN
91                       JIALE XU
92                      YANG ZHAO
93                    XINWEI DENG
94                       MING XIE
95                    JINGCI MENG
96                  ISMOR FISCHER
97                    JIAJIE CHEN
98                  ZUOFENG SHANG
99                      HAO ZHENG
100                         XU XU
101                       BIN ZHU
102                    QUEFENG LI
103                    YU QIU LIU
104                        JUN LI
105                       FAN GAO
106            VICTORIA MANSFIELD
107                      ANQI SHI
108                   KYLE HEBERT
109                      XIUYU MA
110                  CHENLIANG XU
111                   CHANHAN HSU
112                    YUANZHI LI
113                  KAM-WAH TSUI
114                    XINYU SONG
115                 TIMOTHY IDOWU
116                      XIAO NIE
117                    CHEN CHENG
118                 ANDREW LESLIE
119                    YAOGUO XIE
120                 KEVIN PACKARD
121                        YI LIU
122                    WENZHI CAO
123                JOSEPH DEUTSCH
124                       LAN LUO
125                      RYAN ZEA
126                ROBERT WARDROP
127                  SANGBUM CHOI
128                        XIN LI
129                 SEUNGBONG HAN
130                   ZHIGUO XIAO
131            RICHARD A. JOHNSON
132                      RUI TANG
133            IAN BRANSTAD RILEY
134                      BO HUANG
135         HEATHER MARIE BRAZEAU
136                         XU HE
137         GARY HOWARD SCHROEDER
138                     JUN ZHANG
139                     CHENXI LI
140                SONA Z SWANSON
141                    YUAN JIANG
142                    JUNHEE HAN
143                      LILUN DU
144                    XIRAN WANG
145                   ZIFENG ZHAO
146                     CUIZE HAN
147                    YING ZHANG
148                    JOHN DAVIS
149                     CHEN JING
150                    JINGLAN LI
151                       YI CHAI
152                        THU LE
153                    ALAN HUANG
154                   HAOYANG FAN
155                      BOWEN HU
156               TZU HSIANG HUNG
157                    TUN LEE NG
158               ABIGAIL BENZINE
159           ALEXANDER COVINGTON
160                 CHELSEY GREEN
161               MICHAEL KUTZLER
162                    LILI ZHENG
163                  REBECCA POST
164                       LU YANG
165                     RUOSI GUO
166                      XUN ZHAO
167                       MIN NIU
168                       JIAN WU
169                     WEI ZHENG
170                     XINJIE HE
171                       JIE WEI
172           CLAUDIA SOLIS LEMUS
173                   XUEYAO CHEN
174            MANJUSHA KANCHARLA
175              MITCHELL PAUKNER
176                    XIAOWU DAI
177               CHENGNING ZHANG
178                       GINA OH
179                      LUXI CAO
180                     SONG WANG
181                        LAM HO
182                       TIEN VO
183                  SHIZHEN WANG
184                SOHEIL SADEGHI
185                  BINGYING XIE
186                       GENG LI
187             JENNIFER BIRSTLER
188              MARIA KAMENETSKY
189                   KYLE HERBET
190                  JIANCHANG HU
191                       TRAM TA
192                     YUAN WANG
193               KAZUHIKO SHINKI
194                   SIJIAN WANG
195                CHIEN-WEI CHEN
196                BEHZAD AALIPUR
197                    DEREK BEAN
198              BEN ADAM HAALAND
199               ELOISA D CHAVAS
200                     YALI WANG
201               VARSHA KULKARNI
202           SCOTT JOSEPH HETZEL
203                  MIN JUNG LEE
204                     FANG FANG
205                KRISTEN CYFFKA
206                   TING-LI LIN
207                   BRET LARGET
208               KATHERINE GOODE
209                 ERIK NORDHEIM
210                      NING FAN
211                    ANRU ZHANG
212              GARVESH RASKUTTI
213  KRISHNAKUMAR BALASUBRAMANIAN
214                   YAZHEN WANG
215                   CHAOYANG YU
216                   YILIN ZHANG
217                ZHENGJUN ZHANG
218                  XIUFENG SHAO
219                       YUAN LI
220                   BRET HANLON
221                      LILI LAN
222                    CECILE ANE
223                ZHANG CHUNMING
224                        LEI XU
225                    MUHONG GAO
226                 AUGUST JENSEN
227                      XIAO GUO
228               THOMAS G. KURTZ
229            NICHOLAS HENDERSON
230               CHENSHENG KUANG
231                     TAERI UHM
232            NORBERT BINKIEWICZ
233                     KARL ROHE
234                   JUNGWON MUN
235                 JOSEP GINEBRA
236                        TAO YU
237                     XINXIN YU
238                      HAO ZHOU
239                     LIE XIONG
240                 QIAN ZHIGUANG
241                      SHANG WU
242                       SHAN LU
243        STEPHEN AARON STANHOPE
244                LANCINE KONATE
245 GUILHERME VIEIRA NUNES LUDWIG
246              PAUL SAVARIAPPAN
247                     CUICUI QI
248                  KJELL DOKSUM
249                  DEREK NORTON
250              KEEGAN KORTHAUER
251                   KAILEI CHEN
252       THEVAASIINEN CHANDERENG
253                     JOHN KANE
254                    SOKOL VAKO
255                       QING LI
256                     YOUNG LEE
257                HYUNSEUNG KANG
258     BEHZAD AALIPUR HAFSHEJANI
259                   SHULEI WANG
260                   ZHONGJIE YU
261                        LIN QI
262                    JIWEI ZHAO
263                  SUNDUZ KELES
264                     SHUYUN YE
265                      HUI WANG
266            KEVIN HASEGAWA ENG
267                   XIAODAN WEI
268                    MARIA ROJO
269                    RUIFENG XU
270                  YONGJOON KIM
271               NELLIE LAUGHLIN
272                 MICHAEL HOGAN
273                   KARL BROMAN
274                REBECCA KOSCIK
275                   RONGJUN ZHU
276                   BI CHENG WU
277                    YUNONG LIN
278                  ZHIGENG GENG
279                 XIAOPING FENG
280                  SHUANG HUANG
281                   GUANNAN SUN
282                  JEE YEON KIM
283              GREGORY SHINAULT
284                  TONGHAI YANG
285              TIMO SEPPALAINEN
286                 BENEDEK VALKO
287               DAVID GRIFFEATH
288                DAVID ANDERSON
289                   PHILIP WOOD
290              FLORIAN BERTRAND
291         JASON RICHARD SWANSON
292             ALEXANDER KISELEV
293              SAMUEL STECHMANN
294                  WAI TONG FAN
295                       JUN YIN
296                 STEFFEN LEMPP
297                  RUIFANG SONG
298                JAMES D KUELBS
299                  ANATOLE BECK
300                  DONGHYUN LEE
301                 ANDREJ ZLATOS
302           DANIELE CAPPELLETTI
303                 MIHAELA IFRIM
304                SEBASTIEN ROCH
305                 SCOTT HOTTOVY
306             JONATHON PETERSON
307               STEPHEN WAINGER
308                ALEXANDER FISH
309        GREGORIO MORENO-FLORES
310             SUKHENDU MEHROTRA
311           DIETRICH UHLENBROCK
312                   LEV BORISOV
313             RICHARD A BRUALDI
314                 ARNOLD MILLER
315               MATTHEW BALLARD
316                ALBRECHT KLEMM
317            PAUL M TERWILLIGER
318                    STEVEN SAM
319                       KEN ONO
320                 ROBERT HARRON
321                    YANNAN QIU
322         JOHN WILTSHIRE-GORDON
323                 KYUNGMANN KIM
324            CHRISTOPHER WAGNER
325                  PAUL RATHOUZ
326                STEPHEN WRIGHT
327                BENJAMIN RECHT
328                MICHAEL FERRIS
329           JESSE THOMAS HOLZER
330                     HUILIN HU
331               ALBERTO DEL PIA
332                ROBERT R MEYER
333                       SHI JIN
334                MARY LINDSTROM
335          ADIN-CRISTIAN ANDREI
336                  MICHAEL LIOU
337                   CHAOQUN MEI
338      CHRISTINA M. KENDZIORSKI
339                RONALD GANGNON
340            ROBERT WAYNE GREEN
341                     COLE COOK
342                MURRAY CLAYTON
343                      QI JIANG
344                       JUN ZHU
345                 ANNE BRUCKNER
346                       TING YE
347                      JUN SHAO
348                  HUAIBAO FENG
349                     ZIJIAN NI
350                   THOMAS COOK
351           RICHARD J. CHAPPELL
352                   MOO K CHUNG
353                MICHAEL NEWTON
354                 BRIAN YANDELL
355               MICHELLE HARRIS
356                 NORMAN DRAPER
357                   YU MENGGANG
358                     MING YUAN
359                 FANGFANG WANG
360                     JUNHO LEE
361                   GRACE WAHBA
362                  JASON P FINE
363          MICHAEL RENE KOSOROK
364                     YAJUAN SI
365                        LU MAO
366                  DAVID DEMETS
367                JAMES ANDERSON
368                  EDWARD ERKER
369                    SHUAI CHEN
370                    MARI PALTA
371                  GUANHUA CHEN
372  SRIKANTHMADHAVAN ARAVAMUTHAN
373         NATALIA DE LEON GATTI
374                GUILHERME ROSA
375                 YANBING ZHENG
376            CHRISTINE SORKNESS
377               MARIAN R FISHER</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"SELECT COUNT (DISTINCT(instructors.name)) FROM instructors INNER JOIN teachings</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">           ON instructors.id = teachings.instructor_id INNER JOIN sections</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">           ON teachings.section_uuid = sections.uuid INNER JOIN subject_memberships</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">           ON subject_memberships.course_offering_uuid = sections.course_offering_uuid</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">           INNER JOIN subjects</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">           ON subject_memberships.subject_code = subjects.code</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">           WHERE subjects.abbreviation = 'STAT'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  COUNT (DISTINCT(instructors.name))
1                                377</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>O GPA americano é definido numa escala de 0 a 4, em que A = 4, AB = 3.5, B = 3, BC = 2.5, C = 2, D = 1 e F = 0. Determinando a nota média de cada oferecimento pela ponderação da quantidade de alunos em cada extrato com os valores numéricos de cada conceito, indique (no que se referente a disciplinas no assunto de estatística):</li>
</ol>
<p>Quem é o professor mais difícil?</p>
<p>Quem é o professor mais fácil?</p>
<p>Qual é a disciplina mais difícil?</p>
<p>Qual é a disciplina mais fácil?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Remove view statprofs se existir</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(conn, <span class="st">"DROP VIEW IF EXISTS statprofs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cria a view statprofs com professores e cursos STAT (usando aliases)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(conn, <span class="st">"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">CREATE VIEW statprofs AS</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT DISTINCT i.name AS prof, </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">                c.name AS course, </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">                co.course_uuid</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">FROM instructors i</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN teachings t ON i.id = t.instructor_id</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN sections s ON t.section_uuid = s.uuid</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN course_offerings co ON s.course_offering_uuid = co.uuid</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN courses c ON co.course_uuid = c.uuid</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN subject_memberships sm ON sm.course_offering_uuid = s.course_offering_uuid</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN subjects sub ON sm.subject_code = sub.code</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE sub.abbreviation = 'STAT'</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função para gerar consulta GPA com aliases claros</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>gpa_query_template <span class="ot">&lt;-</span> <span class="cf">function</span>(group_field, <span class="at">order =</span> <span class="st">"ASC"</span>, <span class="at">limit =</span> <span class="dv">1</span>) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_field deve ser "i.name" ou "c.name" e tabela base será 'instructors' ou 'courses'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (group_field <span class="sc">==</span> <span class="st">"i.name"</span>) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    base_tables <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="st">      instructors i</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">      JOIN teachings t ON i.id = t.instructor_id</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">      JOIN sections s ON t.section_uuid = s.uuid</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">      JOIN course_offerings co ON s.course_offering_uuid = co.uuid</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    group_by_field <span class="ot">&lt;-</span> <span class="st">"i.name"</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    join_condition <span class="ot">&lt;-</span> <span class="st">"s.course_offering_uuid = co.uuid"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (group_field <span class="sc">==</span> <span class="st">"c.name"</span>) {</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    base_tables <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="st">      courses c</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="st">      JOIN course_offerings co ON c.uuid = co.course_uuid</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    group_by_field <span class="ot">&lt;-</span> <span class="st">"c.name"</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    join_condition <span class="ot">&lt;-</span> <span class="st">"co.uuid = co.uuid"</span>  <span class="co"># só pra sintaxe; não usado</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"group_field deve ser 'i.name' ou 'c.name'"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">"</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT %s AS nome,</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="st">           ROUND(AVG(</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="st">             CASE </span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="st">               WHEN (COALESCE(gd.a_count,0) + COALESCE(gd.ab_count,0) + COALESCE(gd.b_count,0) + COALESCE(gd.bc_count,0) + COALESCE(gd.c_count,0) + COALESCE(gd.d_count,0) + COALESCE(gd.f_count,0)) = 0 THEN NULL</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="st">               ELSE</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="st">                 (4*COALESCE(gd.a_count,0) + 3.5*COALESCE(gd.ab_count,0) + 3*COALESCE(gd.b_count,0) + 2.5*COALESCE(gd.bc_count,0) + 2*COALESCE(gd.c_count,0) + 1*COALESCE(gd.d_count,0)) * 1.0 /</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="st">                 (COALESCE(gd.a_count,0) + COALESCE(gd.ab_count,0) + COALESCE(gd.b_count,0) + COALESCE(gd.bc_count,0) + COALESCE(gd.c_count,0) + COALESCE(gd.d_count,0) + COALESCE(gd.f_count,0))</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="st">             END</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="st">           ), 2) AS gpa_medio</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM %s</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="st">    JOIN grade_distributions gd ON co.uuid = gd.course_offering_uuid</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE co.course_uuid IN (SELECT course_uuid FROM statprofs)</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY %s</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="st">    HAVING gpa_medio IS NOT NULL</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY gpa_medio %s</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="st">    LIMIT %d</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>, group_by_field, base_tables, group_by_field, order, limit)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Professor mais difícil (menor GPA)</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>prof_dificil <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="fu">gpa_query_template</span>(<span class="st">"i.name"</span>, <span class="st">"ASC"</span>))</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Professor mais difícil:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Professor mais difícil:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prof_dificil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            nome gpa_medio
1 JAMES D KUELBS       2.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Professor mais fácil (maior GPA)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>prof_facil <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="fu">gpa_query_template</span>(<span class="st">"i.name"</span>, <span class="st">"DESC"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Professor mais fácil:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Professor mais fácil:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prof_facil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       nome gpa_medio
1 YAJUAN SI         4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disciplina mais difícil (menor GPA)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>disc_dificil <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="fu">gpa_query_template</span>(<span class="st">"c.name"</span>, <span class="st">"ASC"</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Disciplina mais difícil:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Disciplina mais difícil:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(disc_dificil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       nome gpa_medio
1 Introduction to the Theory of Probability      2.89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disciplina mais fácil (maior GPA)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>disc_facil <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="fu">gpa_query_template</span>(<span class="st">"c.name"</span>, <span class="st">"DESC"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Disciplina mais fácil:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Disciplina mais fácil:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(disc_facil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             nome gpa_medio
1 Sample Survey Theory and Method         4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove view statprofs para limpeza</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(conn, <span class="st">"DROP VIEW IF EXISTS statprofs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Desconecte do banco de dados.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(conn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>